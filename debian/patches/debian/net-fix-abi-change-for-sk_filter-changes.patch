From: Ben Hutchings <ben@decadent.org.uk>
Date: Thu, 29 Dec 2016 01:31:15 +0000
Subject: net: Fix ABI change for sk_filter changes
Forwarded: not-needed

Restore sk_filter() and sk_receive_skb() as exported functions rather
than inlines.

---
--- a/include/linux/filter.h
+++ b/include/linux/filter.h
@@ -151,10 +151,7 @@ static inline unsigned int sk_filter_len
 }
 
 int sk_filter_trim_cap(struct sock *sk, struct sk_buff *skb, unsigned int cap);
-static inline int sk_filter(struct sock *sk, struct sk_buff *skb)
-{
-	return sk_filter_trim_cap(sk, skb, 1);
-}
+int sk_filter(struct sock *sk, struct sk_buff *skb);
 extern unsigned int sk_run_filter(const struct sk_buff *skb,
 				  const struct sock_filter *filter);
 extern int sk_attach_filter(struct sock_fprog *fprog, struct sock *sk);
--- a/include/net/sock.h
+++ b/include/net/sock.h
@@ -1271,11 +1271,7 @@ static inline void sock_put(struct sock
 
 int __sk_receive_skb(struct sock *sk, struct sk_buff *skb, const int nested,
 		     unsigned int trim_cap);
-static inline int sk_receive_skb(struct sock *sk, struct sk_buff *skb,
-				 const int nested)
-{
-	return __sk_receive_skb(sk, skb, nested, 1);
-}
+int sk_receive_skb(struct sock *sk, struct sk_buff *skb, const int nested);
 
 static inline void sk_tx_queue_set(struct sock *sk, int tx_queue)
 {
--- a/net/core/filter.c
+++ b/net/core/filter.c
@@ -97,6 +97,12 @@ int sk_filter_trim_cap(struct sock *sk,
 }
 EXPORT_SYMBOL(sk_filter_trim_cap);
 
+int sk_filter(struct sock *sk, struct sk_buff *skb)
+{
+	return sk_filter_trim_cap(sk, skb, 1);
+}
+EXPORT_SYMBOL(sk_filter);
+
 /**
  *	sk_run_filter - run a filter on a socket
  *	@skb: buffer to run the filter on
--- a/net/core/sock.c
+++ b/net/core/sock.c
@@ -385,6 +385,12 @@ void sk_reset_txq(struct sock *sk)
 }
 EXPORT_SYMBOL(sk_reset_txq);
 
+int sk_receive_skb(struct sock *sk, struct sk_buff *skb, const int nested)
+{
+	return __sk_receive_skb(sk, skb, nested, 1);
+}
+EXPORT_SYMBOL(sk_receive_skb);
+
 struct dst_entry *__sk_dst_check(struct sock *sk, u32 cookie)
 {
 	struct dst_entry *dst = __sk_dst_get(sk);
