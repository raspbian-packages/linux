commit b4f35d9f2a6284e8075bd1c6020a1bc55a8a7975
Author: popcornmix <popcornmix@gmail.com>
Date:   Wed May 16 14:15:12 2012 +0100

    Fix for bug in mbox_read. Thanks lp0

Index: linux-3.2.46/arch/arm/mach-bcm2708/power.c
===================================================================
--- linux-3.2.46.orig/arch/arm/mach-bcm2708/power.c	2013-07-26 19:32:25.000000000 +0000
+++ linux-3.2.46/arch/arm/mach-bcm2708/power.c	2013-07-26 19:33:01.000000000 +0000
@@ -97,8 +97,6 @@
 				bcm_mailbox_write(MBOX_CHAN_POWER,
 						  global_request << 4);
 
-				/* Wait for a response during power-up */
-				mdelay(10);
 				if (global_request & ~g_state.global_request) {
 					rc = bcm_mailbox_read(MBOX_CHAN_POWER,
 							      &actual);
Index: linux-3.2.46/arch/arm/mach-bcm2708/vcio.c
===================================================================
--- linux-3.2.46.orig/arch/arm/mach-bcm2708/vcio.c	2013-07-26 19:31:51.000000000 +0000
+++ linux-3.2.46/arch/arm/mach-bcm2708/vcio.c	2013-07-26 19:33:01.000000000 +0000
@@ -119,8 +119,7 @@
 	if (mbox->magic != MBOX_MAGIC)
 		rc = -EINVAL;
 	else {
-		if (mbox->msg[chan] ||
-		    (down_interruptible(&mbox->sema[chan]) == 0)) {
+		if (down_interruptible(&mbox->sema[chan]) == 0) {
 			*data28 = MBOX_DATA28(mbox->msg[chan]);
 			mbox->msg[chan] = 0;
 			rc = 0;
Index: linux-3.2.46/drivers/video/bcm2708_fb.c
===================================================================
--- linux-3.2.46.orig/drivers/video/bcm2708_fb.c	2013-07-26 19:32:58.000000000 +0000
+++ linux-3.2.46/drivers/video/bcm2708_fb.c	2013-07-26 19:33:01.000000000 +0000
@@ -18,7 +18,6 @@
 #include <linux/errno.h>
 #include <linux/string.h>
 #include <linux/slab.h>
-#include <linux/delay.h>
 #include <linux/mm.h>
 #include <linux/fb.h>
 #include <linux/init.h>
@@ -221,8 +220,7 @@
 	/* inform vc about new framebuffer */
 	bcm_mailbox_write(MBOX_CHAN_FB, fb->dma);
 
-	/* workaround occasional failure to read results. TODO: replace fb driver with vchiq version */
-	msleep(10);
+	/* TODO: replace fb driver with vchiq version */
 	/* wait for response */
 	bcm_mailbox_read(MBOX_CHAN_FB, &val);
 
