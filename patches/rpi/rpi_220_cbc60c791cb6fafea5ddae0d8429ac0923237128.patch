commit cbc60c791cb6fafea5ddae0d8429ac0923237128
Author: popcornmix <popcornmix@gmail.com>
Date:   Tue Aug 21 12:25:47 2012 +0100

    Another fix for 10 second hang on closing sound driver

Index: linux-3.2.46/sound/arm/bcm2835-pcm.c
===================================================================
--- linux-3.2.46.orig/sound/arm/bcm2835-pcm.c	2013-07-26 19:34:33.000000000 +0000
+++ linux-3.2.46/sound/arm/bcm2835-pcm.c	2013-07-26 19:35:38.000000000 +0000
@@ -72,7 +72,7 @@
 			  frames_to_bytes(alsa_stream->substream->runtime, alsa_stream->substream->runtime->status->hw_ptr),
 			  new_period);
 	if (alsa_stream->buffer_size) {
-		alsa_stream->pos += consumed;
+		alsa_stream->pos += consumed &~ (1<<30);
 		alsa_stream->pos %= alsa_stream->buffer_size;
 	}
 
Index: linux-3.2.46/sound/arm/bcm2835.h
===================================================================
--- linux-3.2.46.orig/sound/arm/bcm2835.h	2013-07-26 19:34:33.000000000 +0000
+++ linux-3.2.46/sound/arm/bcm2835.h	2013-07-26 19:35:38.000000000 +0000
@@ -28,7 +28,7 @@
 /*
 #define AUDIO_DEBUG_ENABLE
 #define AUDIO_VERBOSE_DEBUG_ENABLE
-*.
+*/
 
 /* Debug macros */
 
