From: Ben Hutchings <ben@decadent.org.uk>
Date: Thu, 24 Nov 2011 07:45:52 +0000
Subject: [PATCH] bcma: Do not claim PCI device IDs also claimed by brcmsmac
Forwarded: not-needed

brcmsmac was not updated to use the bcma bus driver until Linux 3.3.
For 3.2 we want bcma to claim only the devices that brcmsmac doesn't
support.

Signed-off-by: Ben Hutchings <ben@decadent.org.uk>
---
 drivers/bcma/host_pci.c                |    4 +++-
 drivers/net/wireless/brcm80211/Kconfig |    1 -
 2 files changed, 3 insertions(+), 2 deletions(-)

Index: linux-3.2.46/drivers/bcma/host_pci.c
===================================================================
--- linux-3.2.46.orig/drivers/bcma/host_pci.c	2013-07-26 18:56:31.000000000 +0000
+++ linux-3.2.46/drivers/bcma/host_pci.c	2013-07-26 19:17:29.000000000 +0000
@@ -263,11 +263,13 @@
 #endif /* CONFIG_PM */
 
 static DEFINE_PCI_DEVICE_TABLE(bcma_pci_bridge_tbl) = {
+#if !IS_ENABLED(CONFIG_BRCMSMAC)
 	{ PCI_DEVICE(PCI_VENDOR_ID_BROADCOM, 0x0576) },
-	{ PCI_DEVICE(PCI_VENDOR_ID_BROADCOM, 0x4331) },
 	{ PCI_DEVICE(PCI_VENDOR_ID_BROADCOM, 0x4353) },
 	{ PCI_DEVICE(PCI_VENDOR_ID_BROADCOM, 0x4357) },
 	{ PCI_DEVICE(PCI_VENDOR_ID_BROADCOM, 0x4727) },
+#endif
+	{ PCI_DEVICE(PCI_VENDOR_ID_BROADCOM, 0x4331) },
 	{ 0, },
 };
 MODULE_DEVICE_TABLE(pci, bcma_pci_bridge_tbl);
Index: linux-3.2.46/drivers/net/wireless/brcm80211/Kconfig
===================================================================
--- linux-3.2.46.orig/drivers/net/wireless/brcm80211/Kconfig	2013-07-26 18:56:31.000000000 +0000
+++ linux-3.2.46/drivers/net/wireless/brcm80211/Kconfig	2013-07-26 19:17:29.000000000 +0000
@@ -5,7 +5,6 @@
 	tristate "Broadcom IEEE802.11n PCIe SoftMAC WLAN driver"
 	depends on PCI
 	depends on MAC80211
-	depends on BCMA=n
 	select BRCMUTIL
 	select FW_LOADER
 	select CRC_CCITT
