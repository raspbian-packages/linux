From: Ben Hutchings <ben@decadent.org.uk>
Subject: dm: Avoid ABI change in 3.2.41
Forwarded: not-needed

Commit fd7c092e711e 'dm: fix truncated status strings', backported
into 3.2.41, changed the return type of target_type::status from void
to int.  But we can just as easily leave it as int and ignore the
returned value.

Also, genksyms is too stupid to understand that 'unsigned' is the
same thing as 'unsigned int'.

Index: linux-3.2.46/drivers/md/dm-crypt.c
===================================================================
--- linux-3.2.46.orig/drivers/md/dm-crypt.c	2013-07-26 18:52:21.000000000 +0000
+++ linux-3.2.46/drivers/md/dm-crypt.c	2013-07-26 19:30:30.000000000 +0000
@@ -1725,7 +1725,7 @@
 	return DM_MAPIO_SUBMITTED;
 }
 
-static void crypt_status(struct dm_target *ti, status_type_t type,
+static int crypt_status(struct dm_target *ti, status_type_t type,
 			 char *result, unsigned maxlen)
 {
 	struct crypt_config *cc = ti->private;
@@ -1753,6 +1753,7 @@
 
 		break;
 	}
+	return 0;
 }
 
 static void crypt_postsuspend(struct dm_target *ti)
Index: linux-3.2.46/drivers/md/dm-delay.c
===================================================================
--- linux-3.2.46.orig/drivers/md/dm-delay.c	2013-07-26 18:52:21.000000000 +0000
+++ linux-3.2.46/drivers/md/dm-delay.c	2013-07-26 19:30:30.000000000 +0000
@@ -293,7 +293,7 @@
 	return delay_bio(dc, dc->read_delay, bio);
 }
 
-static void delay_status(struct dm_target *ti, status_type_t type,
+static int delay_status(struct dm_target *ti, status_type_t type,
 			 char *result, unsigned maxlen)
 {
 	struct delay_c *dc = ti->private;
@@ -314,6 +314,8 @@
 			       dc->write_delay);
 		break;
 	}
+
+	return 0;
 }
 
 static int delay_iterate_devices(struct dm_target *ti,
Index: linux-3.2.46/drivers/md/dm-flakey.c
===================================================================
--- linux-3.2.46.orig/drivers/md/dm-flakey.c	2013-07-26 18:52:21.000000000 +0000
+++ linux-3.2.46/drivers/md/dm-flakey.c	2013-07-26 19:30:31.000000000 +0000
@@ -331,7 +331,7 @@
 	return error;
 }
 
-static void flakey_status(struct dm_target *ti, status_type_t type,
+static int flakey_status(struct dm_target *ti, status_type_t type,
 			  char *result, unsigned maxlen)
 {
 	unsigned sz = 0;
@@ -362,6 +362,7 @@
 
 		break;
 	}
+	return 0;
 }
 
 static int flakey_ioctl(struct dm_target *ti, unsigned int cmd, unsigned long arg)
Index: linux-3.2.46/drivers/md/dm-linear.c
===================================================================
--- linux-3.2.46.orig/drivers/md/dm-linear.c	2013-07-26 18:52:21.000000000 +0000
+++ linux-3.2.46/drivers/md/dm-linear.c	2013-07-26 19:30:31.000000000 +0000
@@ -94,7 +94,7 @@
 	return DM_MAPIO_REMAPPED;
 }
 
-static void linear_status(struct dm_target *ti, status_type_t type,
+static int linear_status(struct dm_target *ti, status_type_t type,
 			  char *result, unsigned maxlen)
 {
 	struct linear_c *lc = (struct linear_c *) ti->private;
@@ -109,6 +109,7 @@
 				(unsigned long long)lc->start);
 		break;
 	}
+	return 0;
 }
 
 static int linear_ioctl(struct dm_target *ti, unsigned int cmd,
Index: linux-3.2.46/drivers/md/dm-mpath.c
===================================================================
--- linux-3.2.46.orig/drivers/md/dm-mpath.c	2013-07-26 18:52:21.000000000 +0000
+++ linux-3.2.46/drivers/md/dm-mpath.c	2013-07-26 19:30:31.000000000 +0000
@@ -1323,7 +1323,7 @@
  *     [priority selector-name num_ps_args [ps_args]*
  *      num_paths num_selector_args [path_dev [selector_args]* ]+ ]+
  */
-static void multipath_status(struct dm_target *ti, status_type_t type,
+static int multipath_status(struct dm_target *ti, status_type_t type,
 			     char *result, unsigned maxlen)
 {
 	int sz = 0;
@@ -1427,6 +1427,8 @@
 	}
 
 	spin_unlock_irqrestore(&m->lock, flags);
+
+	return 0;
 }
 
 static int multipath_message(struct dm_target *ti, unsigned argc, char **argv)
Index: linux-3.2.46/drivers/md/dm-raid.c
===================================================================
--- linux-3.2.46.orig/drivers/md/dm-raid.c	2013-07-26 18:52:21.000000000 +0000
+++ linux-3.2.46/drivers/md/dm-raid.c	2013-07-26 19:30:31.000000000 +0000
@@ -1017,7 +1017,7 @@
 	return DM_MAPIO_SUBMITTED;
 }
 
-static void raid_status(struct dm_target *ti, status_type_t type,
+static int raid_status(struct dm_target *ti, status_type_t type,
 			char *result, unsigned maxlen)
 {
 	struct raid_set *rs = ti->private;
@@ -1153,6 +1153,8 @@
 				DMEMIT(" -");
 		}
 	}
+
+	return 0;
 }
 
 static int raid_iterate_devices(struct dm_target *ti, iterate_devices_callout_fn fn, void *data)
Index: linux-3.2.46/drivers/md/dm-raid1.c
===================================================================
--- linux-3.2.46.orig/drivers/md/dm-raid1.c	2013-07-26 18:52:21.000000000 +0000
+++ linux-3.2.46/drivers/md/dm-raid1.c	2013-07-26 19:30:31.000000000 +0000
@@ -1358,7 +1358,7 @@
 }
 
 
-static void mirror_status(struct dm_target *ti, status_type_t type,
+static int mirror_status(struct dm_target *ti, status_type_t type,
 			  char *result, unsigned maxlen)
 {
 	unsigned int m, sz = 0;
@@ -1394,6 +1394,8 @@
 		if (ms->features & DM_RAID1_HANDLE_ERRORS)
 			DMEMIT(" 1 handle_errors");
 	}
+
+	return 0;
 }
 
 static int mirror_iterate_devices(struct dm_target *ti,
Index: linux-3.2.46/drivers/md/dm-snap.c
===================================================================
--- linux-3.2.46.orig/drivers/md/dm-snap.c	2013-07-26 18:52:21.000000000 +0000
+++ linux-3.2.46/drivers/md/dm-snap.c	2013-07-26 19:30:31.000000000 +0000
@@ -1846,7 +1846,7 @@
 	start_merge(s);
 }
 
-static void snapshot_status(struct dm_target *ti, status_type_t type,
+static int snapshot_status(struct dm_target *ti, status_type_t type,
 			    char *result, unsigned maxlen)
 {
 	unsigned sz = 0;
@@ -1893,6 +1893,8 @@
 					  maxlen - sz);
 		break;
 	}
+
+	return 0;
 }
 
 static int snapshot_iterate_devices(struct dm_target *ti,
@@ -2147,7 +2149,7 @@
 	ti->split_io = get_origin_minimum_chunksize(dev->bdev);
 }
 
-static void origin_status(struct dm_target *ti, status_type_t type,
+static int origin_status(struct dm_target *ti, status_type_t type,
 			  char *result, unsigned maxlen)
 {
 	struct dm_dev *dev = ti->private;
@@ -2161,6 +2163,8 @@
 		snprintf(result, maxlen, "%s", dev->name);
 		break;
 	}
+
+	return 0;
 }
 
 static int origin_merge(struct dm_target *ti, struct bvec_merge_data *bvm,
Index: linux-3.2.46/drivers/md/dm-stripe.c
===================================================================
--- linux-3.2.46.orig/drivers/md/dm-stripe.c	2013-07-26 18:52:21.000000000 +0000
+++ linux-3.2.46/drivers/md/dm-stripe.c	2013-07-26 19:30:31.000000000 +0000
@@ -301,7 +301,7 @@
  *
  */
 
-static void stripe_status(struct dm_target *ti, status_type_t type,
+static int stripe_status(struct dm_target *ti, status_type_t type,
 			  char *result, unsigned maxlen)
 {
 	struct stripe_c *sc = (struct stripe_c *) ti->private;
@@ -329,6 +329,7 @@
 			    (unsigned long long)sc->stripe[i].physical_start);
 		break;
 	}
+	return 0;
 }
 
 static int stripe_end_io(struct dm_target *ti, struct bio *bio,
Index: linux-3.2.46/drivers/md/dm-thin.c
===================================================================
--- linux-3.2.46.orig/drivers/md/dm-thin.c	2013-07-26 18:52:21.000000000 +0000
+++ linux-3.2.46/drivers/md/dm-thin.c	2013-07-26 19:30:31.000000000 +0000
@@ -2090,7 +2090,7 @@
  *    <transaction id> <used metadata sectors>/<total metadata sectors>
  *    <used data sectors>/<total data sectors> <held metadata root>
  */
-static void pool_status(struct dm_target *ti, status_type_t type,
+static int pool_status(struct dm_target *ti, status_type_t type,
 			char *result, unsigned maxlen)
 {
 	int r;
@@ -2171,10 +2171,11 @@
 			DMEMIT("skip_block_zeroing ");
 		break;
 	}
-	return;
+	return 0;
 
 err:
 	DMEMIT("Error");
+	return 0;
 }
 
 static int pool_iterate_devices(struct dm_target *ti,
@@ -2350,7 +2351,7 @@
 /*
  * <nr mapped sectors> <highest mapped sector>
  */
-static void thin_status(struct dm_target *ti, status_type_t type,
+static int thin_status(struct dm_target *ti, status_type_t type,
 			char *result, unsigned maxlen)
 {
 	int r;
@@ -2392,10 +2393,11 @@
 		}
 	}
 
-	return;
+	return 0;
 
 err:
 	DMEMIT("Error");
+	return 0;
 }
 
 static int thin_iterate_devices(struct dm_target *ti,
Index: linux-3.2.46/include/linux/device-mapper.h
===================================================================
--- linux-3.2.46.orig/include/linux/device-mapper.h	2013-07-26 18:52:21.000000000 +0000
+++ linux-3.2.46/include/linux/device-mapper.h	2013-07-26 19:30:31.000000000 +0000
@@ -72,8 +72,8 @@
 typedef int (*dm_preresume_fn) (struct dm_target *ti);
 typedef void (*dm_resume_fn) (struct dm_target *ti);
 
-typedef void (*dm_status_fn) (struct dm_target *ti, status_type_t status_type,
-			      char *result, unsigned maxlen);
+typedef int (*dm_status_fn) (struct dm_target *ti, status_type_t status_type,
+			      char *result, unsigned int maxlen);
 
 typedef int (*dm_message_fn) (struct dm_target *ti, unsigned argc, char **argv);
 
