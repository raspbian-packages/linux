From: Ben Hutchings <ben@decadent.org.uk>
Date: Thu, 31 May 2018 00:12:25 +0100
Subject: wireless: Avoid ABI change in 3.2.102
Forwarded: not-needed

Commit 657308f73e67 "egulatory: add NUL to request alpha2" enlarged
regulatory_request::alpha2 to make it a null-terminated string, so
that it could be used with netlink string functions.  Change it back
and convert to a null-terminated string in a local variable instead.

---
--- a/include/net/regulatory.h
+++ b/include/net/regulatory.h
@@ -66,7 +66,7 @@ enum environment_cap {
 struct regulatory_request {
 	int wiphy_idx;
 	enum nl80211_reg_initiator initiator;
-	char alpha2[3];
+	char alpha2[2];
 	bool intersect;
 	bool processed;
 	enum environment_cap country_ie_env;
--- a/net/wireless/nl80211.c
+++ b/net/wireless/nl80211.c
@@ -6657,9 +6657,14 @@ void nl80211_send_reg_change_event(struc
 		NLA_PUT_U8(msg, NL80211_ATTR_REG_TYPE,
 			   NL80211_REGDOM_TYPE_INTERSECTION);
 	else {
+		u8 alpha2[3];
+
 		NLA_PUT_U8(msg, NL80211_ATTR_REG_TYPE,
 			   NL80211_REGDOM_TYPE_COUNTRY);
-		NLA_PUT_STRING(msg, NL80211_ATTR_REG_ALPHA2, request->alpha2);
+		alpha2[0] = request->alpha2[0];
+		alpha2[1] = request->alpha2[1];
+		alpha2[2] = 0;
+		NLA_PUT_STRING(msg, NL80211_ATTR_REG_ALPHA2, alpha2);
 	}
 
 	if (wiphy_idx_valid(request->wiphy_idx))
